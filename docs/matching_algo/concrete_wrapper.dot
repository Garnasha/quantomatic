digraph {
    node [shape=box]
    edge [fontsize=10]
    
    start [color=green]
    normalise [label="normalise and remove\nempty wires"]
    addverts [label="add all circles to Uc,\nall (non-circle) wire vertices to Uw\nand all nodes to Un"]
    match [label="match all concrete vertices"]
    nopartial [label="is P empty?"]
    die [label=die,color=blue]
    emptywires [label="match empty wires"]
    done [label="return match",color=blue]
    
    start -> normalise -> addverts -> match
    match -> nopartial [label="foreach\nmatching",color=red]
    nopartial -> emptywires [label=yes]
    nopartial -> die [label=no]
    emptywires -> done [label="foreach\nmatching",color=red]
}